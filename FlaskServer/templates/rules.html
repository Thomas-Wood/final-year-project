{% extends "baseAndNavbar.html" %}

{% block content %}

<h2 class="background-primary">Welcome to the rules page!</h2>

<h3>Create New Rule</h3>
<form method="post" action="{{ url_for('add_rule') }}{{ addressParameters }}" enctype="multipart/form-data">
  <div class="row">
    <div class="col">
      <select class="form-select" name="dataForm">
        <option>Most Recent Value</option>
        <option>1 hour Average</option>
        <option>5 min Average</option>
        <option>1 min Average</option>
      </select>
    </div>
    <div class="col-1">
      <h4 class="text-center">From</h4>
    </div>
    <div class="col">
      <select class="form-select" name="dataStream" id="dataStreamOptions">
        <option>Loading DataStreams...</option>
        <script language = "JavaScript">
          $(document).ready(function() {
            setDataStreamOptions("{{ serverAddress }}", "dataStreamOptions")
          });
        </script>
      </select>
    </div>
    <div class="col-1">
      <h4 class="text-center">Is</h4>
    </div>
    <div class="col">
      <select class="form-select" name="comparator">
        <option>lessThan</option>
        <option>moreThan</option>
      </select>
    </div>
    <div class="col">
      <input type="number" class="form-control" placeholder="5000" name="limit">
    </div>
  </div>
  <div class="row">
    <div class="col text-center" style="padding: 20px">
      <button type="submit" class="btn btn-success">Create Rule</button>
    </div>
  </div>
</form>

<h3>Current Rules</h3>
<table class="table">
  <thead>
    <tr>
      <th scope="col">Data Form</th>
      <th scope="col">DataStream</th>
      <th scope="col">Comparator</th>
      <th scope="col">Limit</th>
      <th scope="col">Current State</th>
    </tr>
  </thead>
  <tbody>
    {% for rule in rules %}
      <td>{{ rule['dataForm'] }}</td>
      <td id="datastream-{{ rule['_id'] }}">{{ rule['dataStreamID'] }}</td>
        <script language = "JavaScript">
          $(document).ready(function() {
            setDataStreamName("{{ rule['dataStreamID'] }}", "{{ serverAddress }}", "datastream-{{ rule['_id'] }}")
          });
        </script>
      <td>{{ rule['comparator'] }}</td>
      <td>{{ rule['limit'] }}</td>
      <td id="state-{{ rule['_id'] }}">Calculating state...</td>
        <script language = "JavaScript">
          $(document).ready(function() {
            setAndcalculateState("{{ rule['dataForm'] }}", "{{ rule['dataStreamID'] }}", "{{ rule['comparator'] }}", "{{ rule['limit'] }}", "{{ serverAddress }}", "state-{{ rule['_id'] }}")
          });
        </script>
    {% endfor %}
  </tbody>
</table>

{% endblock %}